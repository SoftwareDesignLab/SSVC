# Name: cxsecurity_parser.py
# Author: Mark Rumsey
# Date: 5/28/23
# Description: Saves all exploit links on cxsecurity database into CSV

import requests
from bs4 import BeautifulSoup
import csv
from datetime import datetime
import time

N_PAGES = 84     # number of pages in database

def main():

    base_url = 'https://cxsecurity.com/exploit/'

    # create output CSV file with timestamp
    now = str(datetime.now()).replace(' ', '_')
    outfile = open(f'cxsecurity_exploit_links_{now}.csv', 'w')
    writer = csv.writer(outfile)

    for page in range(1, N_PAGES+1):

        print(f'Downloading data for page {str(page)}')

        # set url for page
        url = base_url + str(page)

        # download page content and parse html
        page_data = requests.get(url)
        time.sleep(2)
        html = BeautifulSoup(page_data.content, 'html.parser')

        # get links from page
        link_cols = html.find_all('div', class_='col-md-7')
        links = []
        for col in link_cols[:6]:
            links.append(col.find('a'))

        # write links to file
        for link in links:
            writer.writerow([link['href']])
            
    outfile.close()

    print(f'Output saved to cxsecurity_exploit_links_{now}.csv')

if __name__ == '__main__':
    main()