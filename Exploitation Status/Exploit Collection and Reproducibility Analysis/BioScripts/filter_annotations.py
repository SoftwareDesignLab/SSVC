# Name: filter_annotations.py
# Author: Mark Rumsey
# Date: 9/7/23
# Description: Removes skipped annotations from dataset

import csv
import jsonlines

DATA_INPUT_PATH = 'dataset_unfiltered.jsonl'            # unfiltered dataset path
DATA_OUTPUT_PATH = 'dataset.jsonl'                      # output file path
SKIPPED_PATH = 'NVIP_Doccano_Annotations_Sheet3.csv'    # annotations csv path

def main():
    
    skipped = []

    # open csv file
    skipped_file = open(SKIPPED_PATH, 'r')
    csv_reader = csv.reader(skipped_file)

    # add all skipped annotations from file to list
    csv_reader.__next__()
    for row in csv_reader:
        if row[11]:
            skipped.append(int(row[11]))
        else:
            skipped.append(int(row[0]))

    skipped_file.close()

    # open input file
    infile = open(DATA_INPUT_PATH, 'r')
    reader = jsonlines.Reader(infile)

    # open output file
    outfile = open(DATA_OUTPUT_PATH, 'w')
    writer = jsonlines.Writer(outfile)

    # write lines from input to output file if id not skipped
    for obj in reader:
        if obj['id'] not in skipped:
            writer.write(obj)

    reader.close()
    writer.close()
    infile.close()
    outfile.close()

if __name__ == '__main__':
    main()